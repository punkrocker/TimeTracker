@{
    ViewBag.Title = "title";
}
@section scripts{
    <script src="~/Scripts/echarts.min.js" type="text/javascript"></script>
    <script src="~/Scripts/html2canvas.min.js" type="text/javascript"></script>
}
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="index.html">Report</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <span>Monthly Report</span>
        </li>
    </ul>
    <div class="page-toolbar">
        <button type="button" class="btn btn-success" onclick="exportReport();">Export</button>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <!-- BEGIN SAMPLE TABLE PORTLET-->
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-bell-o"></i>Monthly Report
                </div>
            </div>
            <div id="report" class="portlet-body">
                <div class="text-center">
                    <p>这里是固定标题</p>
                    <p>这里是固定标题</p>
                    <p>这里是固定标题</p>
                    <p>这里是固定标题</p>
                    <p>这里是固定标题</p>
                </div>
                <div id="task" style="height:800px;">
                </div>
                <div id="time" style="height:800px;">
                </div>
                <div >
                    @if (!ViewBag.comment.ToString().Trim().Equals(string.Empty))
                    {
                        <p><h4><b>Comment:</b></h4></p>
                        var comments = ViewBag.comment.Split('\n');
                        foreach (var comm in comments)
                        {
                            <span style="margin: 15px">@comm</span><br />
                        }
                    }
                </div>
                <br/>
            </div>
        </div>

    </div>
</div>
<script>

            function exportReport() {
                html2canvas(document.getElementById("report")).then(function (canvas) {
                    var url = canvas.toDataURL('image/png');
                    var a = document.createElement('a');
                    var event = new MouseEvent('click');
                    a.download = name || '生成报告';
                    a.href = url;
                    a.dispatchEvent(event);
                });
            }

            function getTask() {
                var taskChart = echarts.init(document.getElementById('task'));
                // 指定图表的配置项和数据
                option = {
                    title: {
                        text: 'Task Report',
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['Last Month', 'This Month']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    },
                    yAxis: {
                        type: 'category',
                        data:  @Html.Raw(Json.Encode(ViewBag.ProjectNames))
                    },
                    series: [
                        {
                            name: 'Last Month',
                            type: 'bar',
                            data: @Html.Raw(Json.Encode(ViewBag.LastTasks)),
                            label: {
                                normal: {
                                    show: true,
                                    position: 'right'
                                }
                            }
                        },
                        {
                            name: 'This Month',
                            type: 'bar',
                            data: @Html.Raw(Json.Encode(ViewBag.CurrentTasks)),
                            label: {
                                normal: {
                                    show: true,
                                    position: 'right'
                                }
                            }
                        }
                    ]
                };
                // 使用刚指定的配置项和数据显示图表。
                taskChart.setOption(option);
            }

            function getTime() {
                var timeChart = echarts.init(document.getElementById('time'));
                // 指定图表的配置项和数据
                option = {
                    title: {
                        text: 'Time Report',
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['Last Month', 'This Month']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    },
                    yAxis: {
                        type: 'category',
                        data:  @Html.Raw(Json.Encode(ViewBag.ProjectNames))
                    },
                    series: [
                        {
                            name: 'Last Month',
                            type: 'bar',
                            data: @Html.Raw(Json.Encode(ViewBag.LastTimes)),
                            label: {
                                normal: {
                                    show: true,
                                    position: 'right'
                                }
                            }
                        },
                        {
                            name: 'This Month',
                            type: 'bar',
                            data: @Html.Raw(Json.Encode(ViewBag.CurrentTimes)),
                            label: {
                                normal: {
                                    show: true,
                                    position: 'right'
                                }
                            }
                        }
                    ]
                };
                // 使用刚指定的配置项和数据显示图表。
                timeChart.setOption(option);
            }

            getTask();
            getTime();
</script>
